mediastray


OPCIONALES:
sistema de logros
sistema de guardados
sistema de versiones de juegos


ENTIDADES

usuario
en postgres, igual para todos
    -uuid estandar
    nombre PUB
    nickname PUB
    fecha creacion
    descripcion markdown o perfil html PUB FIL
    privilegios
    url de foto PUB
    strikes
    disponibilidad PUB
    contrasegna encriptada
    correo
    telefono
    cumplea単os PUB
    uuids de usuarios seguidos PUB
    uuids de foros seguidos PUB
    uuids de juegos seguidos PUB
    uuids de cosas que les ha dado like
    premium

juego
en postgres, /game/uuid carga la pagina publica
    -uuid PUB
    titulo PUB
    urls de portadas PUB FIL
    publicado PUB
    version PUB
    descripcion markdown PUB
    archivos webgl PUB FIL
    html y css PUB FIL
    builds y urls y plataforma PUB FIL
    uuid del creador PUB
    uuid de otros usuarios creadores o editores PUB
    multimedia relacionada PUB FIL
    fecha creacion PUB
    fecha ultima version PUB
    tiene logros PUB
    token edicion
    endpoint datos guardado
    generos PUB
    idiomas PUB
    likes (uuid de sus due単os) PUB
    token administracion

configuracion logros
en mongo, asociado a un juego
    -uuid
    uuid de juego PUB
    token api logros
    texto PUB
    lista de logros PUB
        -id
        nombre PUB
        descripcion PUB
        endpoint
        objetivo unico o cantidad PUB
        url imagen PUB FIL
        oculto/visible/spoiler PUB
        cant gente que lo tiene PUB
        uuid amigos que lo tienen PUB

datos usuario con juego
en mongo
    -uuid
    -uuid usuario
    -uuid juego
    horas
    ids de logros completados con progreso y fecha
    datos de guardado FIL



foro
en postgres
    -uuid
    titulo PUB
    uuid de juego o nombre externo PUB
    descripcion markdown PUB
    portada html css PUB FIL
    url foto PUB FIL
    url banner PUB FIL
    uuid creador PUB
    publico
    uuids editores
    fecha creacion PUB
    uuids seguidores
    
comentario/post
en mongo (es posible que se aniden las respuestas en el mismo objeto)
    -uuid
    texto markdown que admite multimedia PUB
    uuid creador PUB
    es post o comentario 
    uuid de juego o foro o otro comentario PUB
    likes (uuids de sus due単os) PUB
    fecha creacion PUB
    visibilidad
    spoiler PUB
    programado para x uuid de logro

tag
realmente no se guarda, cuando se hace click en un # busca en el resto de entidades para mostrar resultados

post documentacion
en archivos estaticos
    -url PUB
    texto markdown PUB
    multimedia PUB FIL
    titulo PUB

posibles tablas intermedias en mongo o redis
la mayoria de operaciones de lectura se guardan en redis para accederlas desde alli rapido (con expire)


EXPLICACION JUGAR
el usuario se registra y escoge un juego (feed, busqueda, hilado por otras fuentes, enlace), se crea una sesion para ese usuario y ese juego, junto a un token. el juego carga porque son archivos estaticos con js inyectado (el juego y su canvas estan en /games pero se cargan con un iframe desde react), el juego puede ser descargado en plataformas libres o jugado en la nube con webgl. en el enlace esta como parametro el token de sesion de juego, que el juego webgl usa para hacer peticiones junto al token secreto del juego para guardar los datos del usuario y sus logros

EXPLICACION POST
igual que una red social, la gente puede hacer comentarios a juegos, usuarios o posts asi como crear foros donde se hagan publicaciones. el foro puede estar asociado a un juego de la plataforma o a uno externo (igdb)

EXPLICACION PUBLICAR
el desarrollador hace su juego y consumta los documentos de la plataforma para ver como hacer las funciones de hacer logro y cargar o ver datos de guardado, se guarda en archivos los datos de guardado de un jugador hasta x espacio asi como el juego tambien tiene ciertos limites. el creador podria hacerle un foro, ver estadisticas, versionar..




PAGINAS
/       pagina principal
/about      info (resumen, quejas, legal, sujerencias, info de contacto)
/login      iniciar sesion
/logout     cerrar sesion
/signin     crear cuenta
/settings       ajustes de la plataforma (no de la cuenta) (modo oscuro, cookies, ...)
/user/123       ver usuario (y si ese usuario eres tu, habilita info y opciones extra)
/useredit       edita tu usuario (visibilidad, perfil, juegos)
/browsegames    buscador de juegos
/featuredgames      juegos mas populares
/browseforums       buscador de foros
/browseusers        buscador de usuarios (usuarios publicos, principalmente creadores)
/public/aa          media estatica
/public/mediastray-inject.js        archivo que se inyecta al html con el canvas del juego para habilitar logros, api, tokens, seguridad...
/games/123      archivos estaticos del juego (el usuario solo jugaria en esta url si la siguiente no funciona)
/play/123       pagina con la info del juego, descargas, comentarios, y el iframe de /games/123
/forum/123      ver un foro, ver sus publicaciones, publicar desde alli
/forum/123/settings     si eres editor del foro, modificar sus ajustes
/publishgame        publicar un nuevo juego
/createforum        crear un nuevo foro
/game/123/settings      si eres editor/creador/publisher de un juego, editar sus ajustes
/docs       documentacion variada para api de logros y demas
/docs/123       articulo concreto de la documentacion
/forum/123/456      vista completa de un post
/premium    adquirir premium (no funcional) (aumenta los limites a la hora de subir juegos y a tener muchos archivos de guardado)


ENDPOINTS PRIVADOS /api/v1/private (requieren el token de administracion del backend. dicho token se almacena en el .env del backend y en el .env del frontend de manera encriptada)
ademas de todos los publicos
GET /login  devuelve si con los datos enviados (contrasegna encriptada y correo) es posible hacer login, y devuelve un token de sesion
POST /user   crear un usuario, sign in (y luego hace /login)
PATCH /user     editar la informacion de un usuario (requiere el token de sesion de ese usuario, osea haber hecho login)
GET /validatetoken/user    valida un token de sesion
GET /validatetoken/play    valida un token de sesion de juego
GET /validatetoken/game    valida un token de administracion de juego
POST /forum     crea un foro, requiere token de sesion de usuario, el cual sera su creador
PATCH /forum    edita ajustes de un foro, requiere token de sesion de un usuario con permisos sobre este
DELETE /user    borra/deshabilita un usuario, requiere token de sesion del usuario y los mismos datos que en el login (esto tambien borrara sus juegos)
DELETE /forum   borra/deshabilita un foro, requiere token de sesion del usuario creador y los mismos datos que en el login (esto tambien borrara el contenido publicado en este)
POST /post/123      hace un post o un comentario a x juego, usuario o foro, requiere un token de sesion de usuario
POST /like/123      da like a un juego, comentario o post, requiere un token de sesion de usuario
POST /follow/123    sigue a un juego, usuario o foro, requiere un token de sesion de usuario
POST /game      crea un nuevo juego en la plataforma, requiere un token de sesion de usuario y devuelve un token de administracion de juego
GET /gametoken/123      si es el due単o, borra el token de administracion de juego anterior y devuelve uno nuevo
GET /playsession/123/456    recibe un token de sesion de juego entre un usuario y un juego
PATCH /game/123     edita los detalles de un juego si tiene permisos para ello
DELETE /game/123    borra un juego si tiene permitido hacerlo (esto tambien borra los logros y archivos de guardado)


ENDPOINTS PUBLICOS /api/v1/
/   redirige a la documentacion de la api
GET /validatetoken/api    valida un token para el uso de endpoints privados
GET /logout   redirige a una pagina en donde se borra toda la informacion de la sesion, asi como borrar la sesion y luego redirige a login
GET /game/123   devuelve la info del juego
GET /gamefiles/123/1.0.0-windows    devuelve los archivos descargables
GET /user/123   devuelve la info del usuario si esta publico
GET /featuredgames/10  devuelve los juegos populares
GET /forum/123  devuelve info del foro
GET /post/123   devuelve la info de un comentario a un juego, a un usuario, un post, devuelve un post del foro
GET /achievements/123   devuelve la info de los logros de un juego, si tiene
GET /achievements/123/2     devuelve la info de un logro, si en el body se incluye un uuid de un usuario publico se ve su progreso
POST /achievements/123/2    si incluye un token de sesion de juego valido, el uuid del usuario y el token de administracion del juego actualiza el estado del logro (pensado para desarrolladores de juegos)
GET /savedata/123/456   si incluye un token de sesion de juego valido, el uuid del usuario y el token de administracion del juego: devuelve el progreso json del jugador (pensado para desarrolladores de juegos)
POST /savedata/123/456   si incluye un token de sesion de juego valido, el uuid del usuario y el token de administracion del juego: guarda el progreso json del jugador (pensado para desarrolladores de juegos)
POST /publishgame/123   si incluye un token de administracion del juego y como archivos una build, publica la nueva version de manera automatica